@model DopaMarket.ViewModels.ItemDetailModel

@{
    ViewBag.Title = "Item";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<!-- Page Content-->
<div class="container padding-bottom-3x">
    <div class="row">
        <!-- Poduct Gallery-->
        <div class="col-md-6">
            <div class="product-gallery">
                <div class="gallery-wrapper">
                    <div class="gallery-item video-btn text-center"><a href="#" data-toggle="tooltip" data-type="video" data-video="&lt;div class=&quot;wrapper&quot;&gt;&lt;div class=&quot;video-wrapper&quot;&gt;&lt;iframe class=&quot;pswp__video&quot; width=&quot;960&quot; height=&quot;640&quot; src=&quot;https://www.youtube.com/embed/CjNjcrQZtd8&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;&lt;/div&gt;&lt;/div&gt;" title="Watch video"></a></div>
                </div><span class="product-badge bg-danger">Sale</span>
                <div class="product-carousel owl-carousel gallery-wrapper">
                    @foreach (var image in Model.Images)
                    {
                        <div class="gallery-item" data-hash="@image.Id"><a href="https://picsum.photos/1000/667" data-size="1000x667"><img src="https://picsum.photos/1000/667" alt="Product"></a></div>
                    }
                </div>
                <ul class="product-thumbnails">
                    @foreach (var image in Model.Images)
                    {
                        <li class="active"><a href="#@image.Id"><img src="https://picsum.photos/150/100" alt="Product"></a></li>
                    }
                </ul>
            </div>
        </div>
        <!-- Product Info-->
        <div class="col-md-6">
            <div class="padding-top-2x mt-2 hidden-md-up"></div>
            <div class="sp-categories pb-3"><i class="icon-tag"></i><a href="#">Drones,</a><a href="#">Action cameras</a></div>
            <h2 class="mb-3">@Model.Item.Name</h2><span class="h3 d-block">
                @Model.Item.CurrentPrice€
            </span>
            <p class="text-muted">@Model.Item.TinyDescriptive <a href='#details' class='scroll-to'>More info</a></p>
            <div class="row align-items-end pb-4">
                <div class="col-sm-4">
                    <div class="form-group mb-0">
                        <label for="quantity">Quantity</label>
                        <select class="form-control" id="quantity">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                </div>
                <div class="col-sm-8">
                    <div class="pt-4 hidden-sm-up"></div>
                    <button class="btn btn-primary btn-block m-0" onClick="addToCart(this)" data-item-id='@Model.Item.Id'><i class="icon-bag"></i> Add to Cart</button>
                </div>
            </div>
            <div class="pt-1 mb-4"><span class="text-medium">SKU:</span> #@Model.Item.SKU</div>
            <hr class="mb-2">
        </div>
    </div>
</div>
<!-- Product Details-->
<div class="bg-secondary padding-top-3x padding-bottom-2x mb-3" id="details">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h3 class="h4">Details</h3>
                <p class="mb-4">@Model.Item.Descriptive</p>
                <h3 class="h4">Features</h3>
                <ul class="list-icon mb-4">
                    @foreach (var feature in Model.Features)
                    {
                        <li><i class="icon-check text-success"></i>@feature.Text</li>
                    }
                </ul>
            </div>
            <div class="col-md-6">
                <h3 class="h4">Specifications</h3>
                <ul class="list-unstyled mb-4">
                    @foreach (var itemSpecification in Model.ItemSpecifications)
                    {
                        <li><strong>@itemSpecification.Name:</strong> @itemSpecification.Value @itemSpecification.Unity</li>
                    }
                </ul>
                <h3 class="h4">Shipping Options:</h3>
                <ul class="list-unstyled mb-4">
                    <li><strong>Courier:</strong> 2 - 4 days, $22.50</li>
                    <li><strong>Local Shipping:</strong> up to one week, $10.00</li>
                    <li><strong>UPS Ground Shipping:</strong> 4 - 6 days, $18.00</li>
                    <li><strong>Unishop Global Export:</strong> 3 - 4 days, $25.00</li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- Reviews-->
<div class="container padding-top-2x">
    <div class="row">
        <div class="col-md-4 mb-4">
            <div class="card border-default">
                <div class="card-body">
                    <div class="text-center">
                        <div class="d-inline align-baseline display-3 mr-1">4.2</div>
                        <div class="d-inline align-baseline text-sm text-warning mr-1">
                            <div class="rating-stars">
                                <i class="icon-star filled"></i><i class="icon-star filled"></i><i class="icon-star filled"></i><i class="icon-star filled"></i><i class="icon-star"></i>
                            </div>
                        </div>
                    </div>
                    <div class="pt-3">
                        @foreach (var starInfo in Model.Stars.Reverse())
                        {
                            if (@starInfo.Count > 1)
                            {
                                <label class="text-medium text-sm">5 stars <span class='text-muted'>- @starInfo.Count</span></label>
                            }
                            else if (@starInfo.Count == 1)
                            {
                                <label class="text-medium text-sm">1 star <span class='text-muted'>- @starInfo.Count</span></label>
                            }
                            else
                            {
                                <label class="text-medium text-sm">0 star <span class='text-muted'></span></label>
                            }
                            <div class="progress margin-bottom-1x">
                                <div class="progress-bar bg-warning" role="progressbar" style="width: @((starInfo.Ratio * 100).ToString().Replace(",","."))%; height: 2px;" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        }
                    </div>
                    <div class="pt-2"><a class="btn btn-warning btn-block" href="#" data-toggle="modal" data-target="#leaveReview">Leave a Review</a></div>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <h3 class="padding-bottom-1x">Latest Reviews</h3>
            @foreach (var review in Model.Reviews)
            {
                <!-- Review-->
                <div class="comment">
                    <div class="comment-author-ava"><img src="img/reviews/02.jpg" alt="Comment author"></div>
                    <div class="comment-body">
                        <div class="comment-header d-flex flex-wrap justify-content-between">
                            <h4 class="comment-title">@review.Title</h4>
                            <div class="mb-2">
                                <div class="rating-stars">
                                    @for (int i = 0; i < review.Note; i++)
                                    {
                                        <i class="icon-star filled"></i>
                                    }

                                    @for (int i = review.Note; i < 5; i++)
                                    {
                                        <i class="icon-star"></i>
                                    }
                                </div>
                            </div>
                        </div>
                        <p class="comment-text" style="white-space: pre-line">@review.Text</p>
                        <div class="comment-footer"><span class="comment-meta">@review.Customer.FirstName @review.Customer.LastName</span></div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
<div class="container padding-bottom-3x mb-1">
    <!-- Related Products Carousel-->
    <h3 class="text-center padding-top-2x mt-2 padding-bottom-1x">You May Also Like</h3>
    <!-- Carousel-->
    <div class="owl-carousel" data-owl-carousel="{ &quot;nav&quot;: false, &quot;dots&quot;: true, &quot;margin&quot;: 30, &quot;responsive&quot;: {&quot;0&quot;:{&quot;items&quot;:1},&quot;576&quot;:{&quot;items&quot;:2},&quot;768&quot;:{&quot;items&quot;:3},&quot;991&quot;:{&quot;items&quot;:4},&quot;1200&quot;:{&quot;items&quot;:4}} }">
        <!-- Product-->
        <div class="product-card">
            <div class="product-badge bg-danger">Sale</div><a class="product-thumb" href="shop-single.html"><img src="img/shop/products/01.jpg" alt="Product"></a>
            <div class="product-card-body">
                <div class="product-category"><a href="#">Smart home</a></div>
                <h3 class="product-title"><a href="shop-single.html">Echo Dot (2nd Generation)</a></h3>
                <h4 class="product-price">
                    <del>$62.00</del>$49.99
                </h4>
            </div>
            <div class="product-button-group"><a class="product-button btn-wishlist" href="#"><i class="icon-heart"></i><span>Wishlist</span></a><a class="product-button btn-compare" href="#"><i class="icon-repeat"></i><span>Compare</span></a><a class="product-button" href="#" data-toast data-toast-type="success" data-toast-position="topRight" data-toast-icon="icon-check-circle" data-toast-title="Product" data-toast-message="successfuly added to cart!"><i class="icon-shopping-cart"></i><span>To Cart</span></a></div>
        </div>
        <!-- Product-->
        <div class="product-card">
            <a class="product-thumb" href="shop-single.html"><img src="img/shop/products/11.jpg" alt="Product"></a>
            <div class="product-card-body">
                <div class="product-category"><a href="#">Headphones</a></div>
                <h3 class="product-title"><a href="shop-single.html">Edifier W855BT Bluetooth</a></h3>
                <h4 class="product-price">$99.75</h4>
            </div>
            <div class="product-button-group"><a class="product-button btn-wishlist" href="#"><i class="icon-heart"></i><span>Wishlist</span></a><a class="product-button btn-compare" href="#"><i class="icon-repeat"></i><span>Compare</span></a><a class="product-button" href="#" data-toast data-toast-type="success" data-toast-position="topRight" data-toast-icon="icon-check-circle" data-toast-title="Product" data-toast-message="successfuly added to cart!"><i class="icon-shopping-cart"></i><span>To Cart</span></a></div>
        </div>
        <!-- Product-->
        <div class="product-card">
            <div class="rating-stars">
                <i class="icon-star filled"></i><i class="icon-star filled"></i><i class="icon-star filled"></i><i class="icon-star filled"></i><i class="icon-star filled"></i>
            </div><a class="product-thumb" href="shop-single.html"><img src="img/shop/products/06.jpg" alt="Product"></a>
            <div class="product-card-body">
                <div class="product-category"><a href="#">Video games</a></div>
                <h3 class="product-title"><a href="shop-single.html">Xbox One S White</a></h3>
                <h4 class="product-price">$298.99</h4>
            </div>
            <div class="product-button-group"><a class="product-button btn-wishlist" href="#"><i class="icon-heart"></i><span>Wishlist</span></a><a class="product-button btn-compare" href="#"><i class="icon-repeat"></i><span>Compare</span></a><a class="product-button" href="#" data-toast data-toast-type="success" data-toast-position="topRight" data-toast-icon="icon-check-circle" data-toast-title="Product" data-toast-message="successfuly added to cart!"><i class="icon-shopping-cart"></i><span>To Cart</span></a></div>
        </div>
        <!-- Product-->
        <div class="product-card">
            <a class="product-thumb" href="shop-single.html"><img src="img/shop/products/07.jpg" alt="Product"></a>
            <div class="product-card-body">
                <div class="product-category"><a href="#">Smartphones</a></div>
                <h3 class="product-title"><a href="shop-single.html">Samsung Galaxy S9+</a></h3>
                <h4 class="product-price">$839.99</h4>
            </div>
            <div class="product-button-group"><a class="product-button btn-wishlist" href="#"><i class="icon-heart"></i><span>Wishlist</span></a><a class="product-button btn-compare" href="#"><i class="icon-repeat"></i><span>Compare</span></a><a class="product-button" href="#" data-toast data-toast-type="success" data-toast-position="topRight" data-toast-icon="icon-check-circle" data-toast-title="Product" data-toast-message="successfuly added to cart!"><i class="icon-shopping-cart"></i><span>To Cart</span></a></div>
        </div>
        <!-- Product-->
        <div class="product-card">
            <div class="product-badge bg-secondary border-default text-body">Out of stock</div><a class="product-thumb" href="shop-single.html"><img src="img/shop/products/12.jpg" alt="Product"></a>
            <div class="product-card-body">
                <div class="product-category"><a href="#">Wearable electornics</a></div>
                <h3 class="product-title"><a href="shop-single.html">Apple Watch Series 3</a></h3>
                <h4 class="product-price">$329.10</h4>
            </div>
            <div class="product-button-group"><a class="product-button btn-wishlist" href="#"><i class="icon-heart"></i><span>Wishlist</span></a><a class="product-button btn-compare" href="#"><i class="icon-repeat"></i><span>Compare</span></a><a class="product-button" href="shop-single.html"><i class="icon-arrow-right"></i><span>Details</span></a></div>
        </div>
        <!-- Product-->
        <div class="product-card">
            <div class="rating-stars">
                <i class="icon-star filled"></i><i class="icon-star filled"></i><i class="icon-star filled"></i><i class="icon-star filled"></i><i class="icon-star"></i>
            </div><a class="product-thumb" href="shop-single.html"><img src="img/shop/products/10.jpg" alt="Product"></a>
            <div class="product-card-body">
                <div class="product-category"><a href="#">Printers &amp; Ink</a></div>
                <h3 class="product-title"><a href="shop-single.html">HP LaserJet Pro Printer</a></h3>
                <h4 class="product-price">$249.50</h4>
            </div>
            <div class="product-button-group"><a class="product-button btn-wishlist" href="#"><i class="icon-heart"></i><span>Wishlist</span></a><a class="product-button btn-compare" href="#"><i class="icon-repeat"></i><span>Compare</span></a><a class="product-button" href="#" data-toast data-toast-type="success" data-toast-position="topRight" data-toast-icon="icon-check-circle" data-toast-title="Product" data-toast-message="successfuly added to cart!"><i class="icon-shopping-cart"></i><span>To Cart</span></a></div>
        </div>
        <!-- Product-->
        <div class="product-card">
            <div class="product-badge bg-danger">Sale</div><a class="product-thumb" href="shop-single.html"><img src="img/shop/products/09.jpg" alt="Product"></a>
            <div class="product-card-body">
                <div class="product-category"><a href="#">Action cameras</a></div>
                <h3 class="product-title"><a href="shop-single.html">Samsung Gear 360 Camera</a></h3>
                <h4 class="product-price">
                    <del>$74.00</del>$68.00
                </h4>
            </div>
            <div class="product-button-group"><a class="product-button btn-wishlist" href="#"><i class="icon-heart"></i><span>Wishlist</span></a><a class="product-button btn-compare" href="#"><i class="icon-repeat"></i><span>Compare</span></a><a class="product-button" href="#" data-toast data-toast-type="success" data-toast-position="topRight" data-toast-icon="icon-check-circle" data-toast-title="Product" data-toast-message="successfuly added to cart!"><i class="icon-shopping-cart"></i><span>To Cart</span></a></div>
        </div>
    </div>
</div>

@section scripts
    {
    <script>
        function addToCart(button) {
            let itemId = button.getAttribute('data-item-id');
            let count = $("#quantity").val();

            $.ajax({
                url: "/Cart/AddItem/" + itemId + "?count=" + count,
            }).done(function (response) {
                if (response.result === "added") {
                    iziToast.show({
                        title: 'OK',
                        message: 'Successfully inserted record!',
                        position: 'topRight'
                    });
                    GetItemsInCart();
                    //bootbox.dialog({
                    //    title: 'Article ajouté au panier',
                    //    message: "<p>Voulez vous voire le contenu de votre panier.</p>",
                    //    buttons: {
                    //        cancel: {
                    //            label: "Revenir à l'article!",
                    //            className: 'btn-danger',
                    //        },
                    //        ok: {
                    //            label: "Aller au panier",
                    //            className: 'btn-info',
                    //            callback: function () {
                    //                window.location.href = '/Cart';
                    //            }
                    //        }
                    //    }
                    //});
                }
            });
        }
    </script>

}
@*
    <h2>Item view</h2>

    @Model.Item.Name
    <button class="btn btn-default" onClick="buyItem(this)" data-item-id='@Model.Item.Id' type="button">Ajouter au panier</button>

    <table>
        @foreach (var itemInfo in Model.ItemInfos)
        {
            <tr>
                <td>@itemInfo.Name</td>
                <td>@itemInfo.Value @itemInfo.Unity</td>
            </tr>
        }
    </table>

    <hr />

    <div>
        @foreach (var review in Model.Reviews)
        {
            <div><span>@review.Customer.FirstName</span><span>@review.Note</span></div>
            <div>@review.Text</div>
        }
    </div>


    @using (Html.BeginForm("PushReview", "ItemAction", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        <div class="form-group">
            @Html.TextBox("note")
        </div>

        <div class="form-group">
            @Html.TextBox("text")
        </div>

        @Html.Hidden("itemId", Model.Item.Id);

        <button type="submit" class="btn btn-primary">Envoyer</button>
    }

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    @section scripts
    {
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js">
        </script>

        <script type="text/javascript">

            function buyItem(button) {
                let itemId = button.getAttribute('data-item-id');

                $.ajax({
                    url: "/Cart/AddItem/" + itemId,
                }).done(function (response) {
                    if (response.result === "added") {
                        bootbox.dialog({
                            title: 'Article ajouté au panier',
                            message: "<p>Voulez vous voire le contenu de votre panier.</p>",
                            buttons: {
                                cancel: {
                                    label: "Revenir à l'article!",
                                    className: 'btn-danger',
                                },
                                ok: {
                                    label: "Aller au panier",
                                    className: 'btn-info',
                                    callback: function () {
                                        window.location.href = '/Cart';
                                    }
                                }
                            }
                        });
                    }
                });
            }

        </script>
    }
*@

<!-- Leave a Review-->
<form class="modal fade" method="post" id="leaveReview" tabindex="-1" action="/ItemAction/PushReview">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Leave a Review</h4>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="review-rating">Rating</label>
                    <select class="form-control" name="rating">
                        <option value="5">5 Stars</option>
                        <option value="4">4 Stars</option>
                        <option value="3">3 Stars</option>
                        <option value="2">2 Stars</option>
                        <option value="1">1 Star</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="review-message">Review</label>
                    <textarea class="form-control" id="review-message" name="text" rows="8" required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" type="submit">Submit Review</button>
            </div>
        </div>
    </div>
    <input name="itemId" type="hidden" value="@Model.Item.Id">
</form>